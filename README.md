# Пара слов о задании:

Данное тестовое задание призвано показать как вы решаете задачу проектирования добавления фитчи в существующий проект.
Данная задача была решена нами ранее и мы хотели бы посмотреть к какому решению придете вы.

# Описание:

Сервер мобильного приложения "Справочник Врача" содержит следующий API метод: `GET api/v1/news`, он возвращает список свежих новостей и вызывается при каждом открытии мобильного приложения (пользователь при этом уже авторизован и запрашивает список новостей, используя oauth токен).

Каждый пользователь (doctors) при регистрации указывает свой город (cities), профессиональный статус (profession_statuses) и 1-5 специализаций (specializations). Например:

- город: Москва
- профессиональный статус: руководящая должность
- специализации: [онколог, уролог]

# Цель:

От отдела маркетинга пришел запрос: мы хотим сегментировать новости и показывать их только пользователям с определенной комбинацией города/статуса/специализации, например:

- Новость о конференции в Москве, должны видеть только неврологи, ревматологи, педиатры, кардиологи из Москвы
- Новость о новой медицинской информационной системе для педиатров в Самаре должны видеть только педиатры руководящих должностей из Самары
- Новость должна быть показана: _онкологам, урологам из Москвы ИЛИ руководящим должностям из Москвы_
- и т.д. (любые комбинации параметров и их значений)

Таким образом, редактор новостного блока должен иметь возможность настроить интересующую его целевую аудиторию в админке и привязать ее к новости.
После чего новость будет выдаваться только пользователям, которые удовлетворяют условиям.
_По умолчанию новость должна публиковаться для всех пользователей._

# Задача:

Разработайте систему сегментации новостей:

- обновите API метод `GET api/v1/news` так, чтобы он начал отдавать клиентам новости, соответствующие их целевой аудитории (помните, что этот метод вызывается при каждом заходе в мобильное приложение)
- предусмотрите возможность указывать целевую аудиторию новости в админке (реализуйте или опишите как бы вы это реализовали)

_P.S. просим вас не делать PR, чтобы не облегчать жизнь соискателям_

# Установка и настройка:

```
git clone https://github.com/skryukov/medsolutions_test
cd medsolutions_test
rails db:setup
rails s
```

Админка: `http://localhost:3000/admin`, логин: `admin@example.com`, пароль: `qwerty`

## Примеры запросов к API

### Авторизация

Запрос:

```
curl --request POST \
  --url http://localhost:3004/oauth/token \
  --header 'Accept: application/json' \
  --form grant_type=password \
  --form username=doctor@example.com \
  --form password=qwerty
```

Ответ:

```js
{
  "access_token": "ab65bbe47485f80dbbdd0691706e0f19265f85219a97df5e81aad78b3cbd0a3d",
  "token_type": "bearer",
  "expires_in": 7200,
  "refresh_token": "b69a2dd9732d8e3a384e3aeab18a145dad4d346271ab86110ba906c7bce54acc",
  "created_at": 1529326868
}
```

### Получение списка новостей

_Для авторизации необходимо использовать заголовок `Authorization` со значением `Bearer access_token`, где `access_token` - значение токена из запроса авторизации_

Запрос:

```
curl --request GET \
  --url http://localhost:3004/api/v1/news \
  --header 'Authorization: Bearer ab65bbe47485f80dbbdd0691706e0f19265f85219a97df5e81aad78b3cbd0a3d'
```

Ответ:

```js
{
  "success": true,
  "data": {
    "news": [
      {
        "id": 1,
        "title": "НПВС повышают риск развития сердечно-сосудистых заболеваний у пациентов с остеоартритом",
        "text": "Текст новости \"НПВС повышают риск развития сердечно-сосудистых заболеваний у пациентов с остеоартритом\"",
        "created_at": "2018-06-18T11:35:05.311Z",
        "updated_at": "2018-06-18T11:35:05.311Z"
      },
      {
        "id": 2,
        "title": "Пульмонологи обеспокоены недостаточным выявлением бронхиальной астмы",
        "text": "Текст новости \"Пульмонологи обеспокоены недостаточным выявлением бронхиальной астмы\"",
        "created_at": "2018-06-18T11:35:05.317Z",
        "updated_at": "2018-06-18T11:35:05.317Z"
      },
    ]
  }
}
```
